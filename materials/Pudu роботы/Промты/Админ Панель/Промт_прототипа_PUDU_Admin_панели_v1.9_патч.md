# Промт-патч v1.9: Ручной ввод номера стола для фудкортов [Р2] — экран Б2

---
**Версия**: 1.9
**Дата**: 2026-02-18
**Автор**: Кирилл Тюрин (системный аналитик)
**Статус**: [PENDING]
**Артефакт**: Д3-патч (Промт-патч для обновления прототипа iikoWeb)
**Базовый документ**: Промт_прототипа_PUDU_Admin_панели_v1.8_патч.md (v1.8, 2026-02-17)
**Источники**: SPEC-002 v1.15 (раздел 6.2 [Р2], таблица действий 6.3 — строки 3б, 3в, 3г); стенограмма 06.02 (Руслан)
**Scope**: Ручной ввод номера стола на экране маппинга (Э3 / Б2) — кнопка, inline-форма, бейдж, удаление, mock-данные
---

## Назначение

Этот документ — **дельта-патч** к промту v1.8 (через цепочку v1.1 → v1.8). Он добавляет **UI для ручного ввода номера стола** на экране маппинга (Э3 / Б2) — функционал, предназначенный для работы с фудкортами, где столы не привязаны к конфигурации залов iiko.

**Приоритет**: **Could** (не обязательно для MVP).

**Бизнес-контекст**:
- Фудкорты и площадки без централизованной конфигурации залов в iiko не имеют столов в системе
- Администратор / инженер NE должен иметь возможность вручную добавить номер стола и привязать к нему точки робота
- Ручные столы хранятся **локально** в БД (`pudu_table_point_mapping`), не синхронизируются с iikoServer
- При синхронизации столов из iiko ручные столы **не удаляются**

> **Руслан** (06.02): *«Предусмотреть ручной ввод номера стола для работы на фудкортах»*

**Инструкция по применению**: сначала примени базовый промт v1.1, затем патчи v1.2 → v1.3 → v1.4 → v1.5 → v1.6 → v1.7 → v1.8 → затем этот патч v1.9 — последовательно.

**Ключевые изменения v1.9:**
- Кнопка «+ Ручной стол» под таблицей маппинга (перед sticky footer)
- Inline-форма ввода номера стола (input + кнопка «Добавить» + кнопка «Отмена»)
- Бейдж `(ручной)` рядом с названием ручного стола в таблице маппинга
- Иконка удаления `trash-2` в строке ручного стола + UiConfirmDialog
- Ручные столы отображаются **при любом фильтре** залов (включая конкретные залы)
- Mock-данные: 2 ручных стола добавлены в массивы `mockTables` и `mockMapping`
- Toast #17 «Ручной стол добавлен»
- Toast #18 «Ручной стол удалён»

---

## Совместимость с предыдущими патчами

| Патч           | Совместимость | Примечание                                               |
| -------------- | ------------- | -------------------------------------------------------- |
| v1.1 (базовый) | Требуется     | Базовые экраны, в т.ч. Э3                                |
| v1.2 (C1–C10)  | Требуется     | C3: универсальный маппинг, убран Select робота           |
| v1.3 (E1–E5)   | Требуется     | E1–E5: технические ID, эксклюзивность, 3 столбца таблицы |
| v1.4 (F1–F13)  | Требуется     | F6: фильтр по залу + toolbar, F8: mock столы с залами    |
| v1.5 (G1–G11)  | Требуется     | —                                                        |
| v1.6           | Требуется     | —                                                        |
| v1.7           | Требуется     | —                                                        |
| v1.8           | Требуется     | —                                                        |

---

## Перечень изменений v1.9

| #      | Изменение                                   | Область | Причина                                                                        |
| ------ | ------------------------------------------- | ------- | ------------------------------------------------------------------------------ |
| **L1** | Интерфейс `IikoTable` — поле `is_manual`    | Типы    | Различение ручных столов от столов iiko в типовой системе                      |
| **L2** | Mock-данные: 2 ручных стола                 | Mock    | Демонстрация функционала в прототипе                                           |
| **L3** | Кнопка «+ Ручной стол» + inline-форма ввода | Э3 (Б2) | SPEC-002 v1.15 [Р2]: ручной ввод номера стола для фудкортов                    |
| **L4** | Бейдж `(ручной)` в столбце «Стол iiko»      | Э3 (Б2) | Визуальное различение ручных столов от системных                               |
| **L5** | Иконка удаления `trash-2` + UiConfirmDialog | Э3 (Б2) | SPEC-002 v1.15 [Р2]: удаление ручных столов                                    |
| **L6** | Toast #17 «Ручной стол добавлен»            | Э3 (Б2) | Подтверждение успешного добавления                                             |
| **L7** | Toast #18 «Ручной стол удалён»              | Э3 (Б2) | Подтверждение удаления                                                         |
| **L8** | Фильтр по залу: ручные столы всегда видны   | Э3 (Б2) | SPEC-002 v1.15 [Р2] + v1.4 F6: ручные столы без `section_name` — не скрываются |

---

## L1. Интерфейс `IikoTable` — поле `is_manual`

### ОБНОВИТЬ: интерфейс `IikoTable` (раздел типов базового промта)

**Было (v1.1):**
```typescript
interface IikoTable {
  table_id: string;
  table_name: string;
  section_name: string;
}
```

**Стало (v1.9):**
```typescript
interface IikoTable {
  table_id: string;         // "tbl-001" (iiko) или "manual-001" (ручной)
  table_name: string;       // "Стол №1" или "42" (ручной ввод)
  section_name: string;     // "Зал 1 этаж" или "" (пустая строка для ручных)
  is_manual: boolean;       // true — ручной стол (фудкорт), false — стол из iiko
}
```

> **Примечание**: Для ручных столов `section_name` = `""` (пустая строка). Поле `table_id` генерируется клиентом с префиксом `manual-` и инкрементом. При сохранении маппинга (`PUT /api/pudu/mapping`) Backend генерирует постоянный UUID.

---

## L2. Mock-данные: 2 ручных стола

### ОБНОВИТЬ: массив `mockTables` (F8, v1.4)

**Было (v1.4 F8, 8 столов):**
```typescript
const mockTables: IikoTable[] = [
  // Зал 1 этаж (5 столов)
  { table_id: "tbl-001", table_name: "Стол №1", section_name: "Зал 1 этаж" },
  { table_id: "tbl-002", table_name: "Стол №2", section_name: "Зал 1 этаж" },
  { table_id: "tbl-003", table_name: "Стол №3 (VIP)", section_name: "Зал 1 этаж" },
  { table_id: "tbl-004", table_name: "Стол №4 (бар)", section_name: "Зал 1 этаж" },
  { table_id: "tbl-005", table_name: "Стол №5", section_name: "Зал 1 этаж" },
  // Терраса (2 стола)
  { table_id: "tbl-006", table_name: "Стол №6", section_name: "Терраса" },
  { table_id: "tbl-007", table_name: "Стол №7", section_name: "Терраса" },
  // VIP-зал (1 стол)
  { table_id: "tbl-008", table_name: "Стол №8 (VIP)", section_name: "VIP-зал" }
];
```

**Стало (v1.9 L2, 10 столов = 8 iiko + 2 ручных):**
```typescript
const mockTables: IikoTable[] = [
  // Зал 1 этаж (5 столов из iiko)
  { table_id: "tbl-001", table_name: "Стол №1", section_name: "Зал 1 этаж", is_manual: false },
  { table_id: "tbl-002", table_name: "Стол №2", section_name: "Зал 1 этаж", is_manual: false },
  { table_id: "tbl-003", table_name: "Стол №3 (VIP)", section_name: "Зал 1 этаж", is_manual: false },
  { table_id: "tbl-004", table_name: "Стол №4 (бар)", section_name: "Зал 1 этаж", is_manual: false },
  { table_id: "tbl-005", table_name: "Стол №5", section_name: "Зал 1 этаж", is_manual: false },
  // Терраса (2 стола из iiko)
  { table_id: "tbl-006", table_name: "Стол №6", section_name: "Терраса", is_manual: false },
  { table_id: "tbl-007", table_name: "Стол №7", section_name: "Терраса", is_manual: false },
  // VIP-зал (1 стол из iiko)
  { table_id: "tbl-008", table_name: "Стол №8 (VIP)", section_name: "VIP-зал", is_manual: false },
  // Ручные столы (фудкорт) — без привязки к залу iiko
  { table_id: "manual-001", table_name: "42", section_name: "", is_manual: true },
  { table_id: "manual-002", table_name: "Столик у входа", section_name: "", is_manual: true },
];
```

### ОБНОВИТЬ: массив `mockMapping` (v1.4, 8 → 10 записей)

**Было (v1.4, 8 записей):**
```typescript
const mockMapping: TableMapping[] = [
  { table_id: "tbl-001", points: [mockPoints[0]] },
  { table_id: "tbl-002", points: [mockPoints[1]] },
  { table_id: "tbl-003", points: [mockPoints[2], mockPoints[3]] },
  { table_id: "tbl-004", points: [mockPoints[4]] },
  { table_id: "tbl-005", points: [] },
  { table_id: "tbl-006", points: [mockPoints[5]] },
  { table_id: "tbl-007", points: [] },
  { table_id: "tbl-008", points: [] }
];
```

**Стало (v1.9 L2, 10 записей):**
```typescript
const mockMapping: TableMapping[] = [
  { table_id: "tbl-001", points: [mockPoints[0]] },                  // Зал 1, Стол №1 → SF234201A
  { table_id: "tbl-002", points: [mockPoints[1]] },                  // Зал 1, Стол №2 → SF234202B
  { table_id: "tbl-003", points: [mockPoints[2], mockPoints[3]] },   // Зал 1, Стол №3 → SF234203C + SF234204D (1:N)
  { table_id: "tbl-004", points: [mockPoints[4]] },                  // Зал 1, Стол №4 → SF234205E
  { table_id: "tbl-005", points: [] },                                // Зал 1, Стол №5 → НЕ ЗАМАПЛЕН
  { table_id: "tbl-006", points: [mockPoints[5]] },                  // Терраса, Стол №6 → SF234206F
  { table_id: "tbl-007", points: [] },                                // Терраса, Стол №7 → НЕ ЗАМАПЛЕН
  { table_id: "tbl-008", points: [] },                                // VIP-зал, Стол №8 → НЕ ЗАМАПЛЕН
  { table_id: "manual-001", points: [mockPoints[6]] },               // Ручной «42» → SF234207G (замаплен)
  { table_id: "manual-002", points: [] },                             // Ручной «Столик у входа» → НЕ ЗАМАПЛЕН
];
// Назначенные: SF234201A...SF234207G (7 шт)
// Свободные: SF234208H, SF234209I, SF234210J (3 шт)
// Незамапленные столы: №5, №7, №8, «Столик у входа» (4 шт)
```

### ДОБАВИТЬ: state для inline-формы и счётчика

```tsx
// v1.9 L2: State для ручного ввода стола
const [showManualTableForm, setShowManualTableForm] = useState(false);
const [manualTableName, setManualTableName] = useState('');
const [manualTableError, setManualTableError] = useState('');
const [manualIdCounter, setManualIdCounter] = useState(3); // следующий ID: manual-003
```

---

## L3. Кнопка «+ Ручной стол» + inline-форма ввода

### Экран Э3 (Б2), файл `app/mapping/page.tsx`

### ДОБАВИТЬ: Кнопку и форму **между таблицей маппинга и sticky footer**

Позиционирование на экране Э3:

```
┌──────────────────────────────────────────────────────────────┐
│  SUBHEADER: Breadcrumb + H1 "Маппинг столов"                │
├──────────────────────────────────────────────────────────────┤
│  TOOLBAR: [Зал: ▼ Все залы] [SegmentedControl]  [↻ Обновить] │
├──────────────────────────────────────────────────────────────┤
│  ⚠ Warning: 4 столов не имеют привязки...                     │
├──────────────────────────────────────────────────────────────┤
│  ТАБЛИЦА МАППИНГА                                            │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ Стол iiko           │ Привязанные точки        │ Статус│  │
│  │─────────────────────┼────────────────────────── ┼───── │  │
│  │ Стол №1             │ [SF234201A ▼] [×]        │  ●   │  │
│  │ ...                 │ ...                      │ ...  │  │
│  │ 42 (ручной) [🗑]    │ [SF234207G ▼] [×]        │  ●   │  │
│  │ Столик у входа      │  —                       │  ○   │  │
│  │   (ручной) [🗑]     │                          │      │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
│  [+ Ручной стол]  ← L3 (новая кнопка, ghost, sm)            │
│                                                              │
│  ── или при раскрытии формы: ──────────────────────────       │
│                                                              │
│  ┌─────────────────────────────────────────────────────┐     │
│  │ Номер / название стола:                              │     │
│  │ [___________________________] [Добавить] [Отмена]    │     │
│  │              ↑ w-48                                   │     │
│  │ Ошибка валидации (если есть)                         │     │
│  └─────────────────────────────────────────────────────┘     │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│  STICKY FOOTER: [Сохранить] [Сбросить]                       │
└──────────────────────────────────────────────────────────────┘
```

### Код кнопки и inline-формы:

```tsx
{/* v1.9 L3: Кнопка «+ Ручной стол» и inline-форма */}
<div className="mt-4 mb-2">
  {!showManualTableForm ? (
    <Button
      variant="ghost"
      size="sm"
      onClick={() => {
        setShowManualTableForm(true);
        setManualTableName('');
        setManualTableError('');
      }}
      className="text-gray-600 hover:text-gray-900"
      aria-label="Добавить ручной стол для фудкорта"
    >
      <Plus className="mr-1.5 h-4 w-4" />
      Ручной стол
    </Button>
  ) : (
    <div className="flex items-start gap-2 p-3 bg-white border border-gray-200 rounded-lg max-w-lg">
      <div className="flex-1 space-y-1">
        <Label htmlFor="manual-table-name" className="text-sm font-medium text-gray-700">
          Номер / название стола
        </Label>
        <Input
          id="manual-table-name"
          value={manualTableName}
          onChange={(e) => {
            setManualTableName(e.target.value);
            setManualTableError('');
          }}
          onKeyDown={(e) => {
            if (e.key === 'Enter') handleAddManualTable();
            if (e.key === 'Escape') {
              setShowManualTableForm(false);
              setManualTableName('');
              setManualTableError('');
            }
          }}
          placeholder="Номер / название стола"
          className={cn("w-48", manualTableError && "border-red-500 focus:ring-red-500")}
          maxLength={50}
          autoFocus
          disabled={false}
          aria-label="Номер или название ручного стола"
        />
        {manualTableError && (
          <p className="text-xs text-red-500">{manualTableError}</p>
        )}
        <p className="text-xs text-gray-400">
          Максимум 50 символов. Для фудкортов без столов в iiko
        </p>
      </div>
      <div className="flex items-end gap-1.5 pt-6">
        <Button
          size="sm"
          onClick={handleAddManualTable}
          disabled={!manualTableName.trim() || !!manualTableError}
        >
          Добавить
        </Button>
        <Button
          variant="ghost"
          size="sm"
          onClick={() => {
            setShowManualTableForm(false);
            setManualTableName('');
            setManualTableError('');
          }}
        >
          Отмена
        </Button>
      </div>
    </div>
  )}
</div>
```

### Логика добавления ручного стола:

```tsx
// v1.9 L3: Обработчик добавления ручного стола
const handleAddManualTable = () => {
  const name = manualTableName.trim();

  // Валидация: не пустое
  if (!name) {
    setManualTableError('Введите номер или название стола');
    return;
  }

  // Валидация: макс. 50 символов
  if (name.length > 50) {
    setManualTableError('Максимум 50 символов');
    return;
  }

  // Валидация: уникальность среди всех столов (iiko + ручные)
  const isDuplicate = tables.some(
    (t) => t.table_name.toLowerCase() === name.toLowerCase()
  );
  if (isDuplicate) {
    setManualTableError(`Стол «${name}» уже существует`);
    return;
  }

  // Создание нового ручного стола
  const newTable: IikoTable = {
    table_id: `manual-${String(manualIdCounter).padStart(3, '0')}`,
    table_name: name,
    section_name: '',
    is_manual: true,
  };
  setManualIdCounter((prev) => prev + 1);

  // Добавить стол в массив столов
  setTables((prev) => [...prev, newTable]);

  // Добавить запись маппинга (пустая — без точек)
  setMapping((prev) => [...prev, { table_id: newTable.table_id, points: [] }]);

  // Пометить, что есть несохранённые изменения
  setHasUnsavedChanges(true);

  // Сбросить форму
  setShowManualTableForm(false);
  setManualTableName('');
  setManualTableError('');

  // Toast подтверждения
  toast({ description: `Ручной стол «${name}» добавлен` });
};
```

### Доступность (Accessibility):

| Элемент                | Атрибут      | Значение                                                    |
| ---------------------- | ------------ | ----------------------------------------------------------- |
| Кнопка «+ Ручной стол» | `aria-label` | «Добавить ручной стол для фудкорта»                         |
| Input                  | `aria-label` | «Номер или название ручного стола»                          |
| Кнопка «Добавить»      | —            | Стандартная семантика `<button>`, disabled при пустом input |
| Кнопка «Отмена»        | —            | Стандартная семантика `<button>`                            |

---

## L4. Бейдж `(ручной)` в столбце «Стол iiko»

### ОБНОВИТЬ: рендер столбца «Стол iiko» в таблице маппинга

**Было (v1.4):**
```tsx
<td className="py-3 px-4">
  <div>
    <span className="text-sm font-medium text-gray-900">
      {table.table_name}
    </span>
    {table.section_name && (
      <span className="ml-2 text-xs text-gray-400">
        {table.section_name}
      </span>
    )}
  </div>
</td>
```

**Стало (v1.9 L4):**
```tsx
<td className="py-3 px-4">
  <div className="flex items-center gap-2">
    <div>
      <span className="text-sm font-medium text-gray-900">
        {table.table_name}
      </span>
      {table.section_name && (
        <span className="ml-2 text-xs text-gray-400">
          {table.section_name}
        </span>
      )}
      {table.is_manual && (
        <span className="ml-2 text-xs text-gray-400 italic">
          (ручной)
        </span>
      )}
    </div>
    {/* L5: Иконка удаления для ручных столов */}
    {table.is_manual && (
      <button
        onClick={(e) => {
          e.stopPropagation();
          setTableToDelete(table);
        }}
        className="ml-auto text-gray-400 hover:text-red-500 transition-colors p-1 rounded hover:bg-red-50"
        aria-label={`Удалить ручной стол «${table.table_name}»`}
      >
        <Trash2 className="h-4 w-4" />
      </button>
    )}
  </div>
</td>
```

### Внешний вид строки ручного стола vs обычного:

```
Обычный стол iiko:
┌─────────────────────────────────┬────────────────────────┬────────┐
│ Стол №3 (VIP)  Зал 1 этаж      │ [SF234203C ▼] [×]      │   ●    │
│                                 │ [SF234204D ▼] [×]      │        │
│                                 │ [+ Точку]              │        │
└─────────────────────────────────┴────────────────────────┴────────┘

Ручной стол:
┌─────────────────────────────────┬────────────────────────┬────────┐
│ 42  (ручной)              [🗑]  │ [SF234207G ▼] [×]      │   ●    │
│                                 │ [+ Точку]              │        │
└─────────────────────────────────┴────────────────────────┴────────┘

Ручной стол (без привязки):
┌─────────────────────────────────┬────────────────────────┬────────┐
│ Столик у входа  (ручной)  [🗑]  │  —                     │   ○    │
│                                 │ [+ Точку]              │        │
└─────────────────────────────────┴────────────────────────┴────────┘
```

> **Примечание**: Иконка `trash-2` отображается **только** для ручных столов (`is_manual === true`). У столов из iiko кнопка удаления отсутствует.

---

## L5. Удаление ручного стола — UiConfirmDialog

### ДОБАВИТЬ: state и диалог подтверждения удаления

```tsx
// v1.9 L5: State для удаления ручного стола
const [tableToDelete, setTableToDelete] = useState<IikoTable | null>(null);
```

### Рендер UiConfirmDialog:

```tsx
{/* v1.9 L5: Диалог подтверждения удаления ручного стола */}
<Dialog open={!!tableToDelete} onOpenChange={() => setTableToDelete(null)}>
  <DialogContent className="max-w-sm">
    <DialogHeader>
      <DialogTitle>Удалить ручной стол?</DialogTitle>
      <DialogDescription>
        Удалить ручной стол «{tableToDelete?.table_name}»?
        Привязанные точки будут освобождены.
      </DialogDescription>
    </DialogHeader>
    <DialogFooter className="gap-2">
      <Button
        variant="ghost"
        onClick={() => setTableToDelete(null)}
      >
        Отмена
      </Button>
      <Button
        variant="destructive"
        onClick={() => {
          if (!tableToDelete) return;

          // Удалить стол из массива
          setTables((prev) =>
            prev.filter((t) => t.table_id !== tableToDelete.table_id)
          );

          // Удалить запись маппинга
          // (привязанные точки автоматически возвращаются в пул свободных)
          setMapping((prev) =>
            prev.filter((m) => m.table_id !== tableToDelete.table_id)
          );

          // Пометить несохранённые изменения
          setHasUnsavedChanges(true);

          // Toast подтверждения
          toast({
            description: `Ручной стол «${tableToDelete.table_name}» удалён`,
          });

          setTableToDelete(null);
        }}
      >
        Удалить
      </Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

### Поведение при удалении:

| Шаг | Действие                                     | Результат                                                                                                                                                   |
| --- | -------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1   | Клик иконки `trash-2` в строке ручного стола | Открывается UiConfirmDialog с названием стола                                                                                                               |
| 2a  | Клик «Удалить»                               | Стол удаляется из таблицы. Привязанные точки возвращаются в пул свободных. Toast #18. Кнопка «Сохранить» становится активной (есть несохранённые изменения) |
| 2b  | Клик «Отмена» или закрытие диалога           | Диалог закрывается, изменений нет                                                                                                                           |
| 3   | Клик «Сохранить» в sticky footer             | Изменения (включая удаление ручного стола) отправляются: `PUT /api/pudu/mapping`                                                                            |

> **Warning**: До нажатия «Сохранить» удаление является **локальным** (только в state). Кнопка «Сбросить» в sticky footer отменяет удаление и восстанавливает стол.

---

## L6. Toast #17 «Ручной стол добавлен»

| #   | Текст                           | Стиль   | Триггер                                              | Длительность |
| --- | ------------------------------- | ------- | ---------------------------------------------------- | ------------ |
| 17  | «Ручной стол «{name}» добавлен» | default | Успешное добавление ручного стола через inline-форму | 3 сек        |

---

## L7. Toast #18 «Ручной стол удалён»

| #   | Текст                         | Стиль   | Триггер                                      | Длительность |
| --- | ----------------------------- | ------- | -------------------------------------------- | ------------ |
| 18  | «Ручной стол «{name}» удалён» | default | Подтверждение удаления через UiConfirmDialog | 3 сек        |

---

## L8. Фильтр по залу: ручные столы всегда видны

### ОБНОВИТЬ: логику фильтрации таблицы маппинга (v1.4 F6)

**Было (v1.4 F6):**
```tsx
const filteredTables = selectedHall === 'all'
  ? tables
  : tables.filter((t) => t.section_name === selectedHall);
```

**Стало (v1.9 L8):**
```tsx
// v1.9 L8: Ручные столы отображаются при любом фильтре
const filteredTables = selectedHall === 'all'
  ? tables
  : tables.filter((t) => t.section_name === selectedHall || t.is_manual);
```

### Поведение фильтра с ручными столами:

| Выбранный фильтр | Видимые столы                                    |
| ---------------- | ------------------------------------------------ |
| «Все залы»       | Все 10 столов (8 iiko + 2 ручных)                |
| «Зал 1 этаж»     | 5 столов iiko (Зал 1) + 2 ручных = **7 строк**   |
| «Терраса»        | 2 стола iiko (Терраса) + 2 ручных = **4 строки** |
| «VIP-зал»        | 1 стол iiko (VIP) + 2 ручных = **3 строки**      |

> **Примечание**: Ручные столы отображаются **в конце таблицы**, после столов выбранного зала. Визуально они отличаются бейджем `(ручной)` и наличием иконки `trash-2`.

### Сортировка строк таблицы маппинга:

```tsx
// v1.9 L8: Сортировка — столы iiko сначала, ручные в конце
const sortedTables = [...filteredTables].sort((a, b) => {
  // Ручные столы всегда в конце
  if (a.is_manual && !b.is_manual) return 1;
  if (!a.is_manual && b.is_manual) return -1;
  // Внутри группы — по имени
  return a.table_name.localeCompare(b.table_name, 'ru');
});
```

---

## Обновление warning-блока (количество незамапленных)

### ОБНОВИТЬ: пересчёт предупреждения о незамапленных столах

Ручные столы без привязки к точкам **учитываются** в подсчёте незамапленных:

```tsx
// v1.9: Подсчёт незамапленных столов (включая ручные)
const unmappedCount = mapping.filter(
  (m) => m.points.length === 0
).length;
```

В текущих mock-данных: 4 незамапленных стола (Стол №5, Стол №7, Стол №8 из iiko + «Столик у входа» ручной).

Текст предупреждения остаётся прежним:
```
⚠ 4 столов не имеют привязки к точкам робота. Робот не сможет доставить заказ к этим столам.
```

---

## Обновление итогового чеклиста

В дополнение к чеклисту v1.8, добавить:

**Ручной ввод стола [Р2] (Э3)**

- [ ] L1: Интерфейс `IikoTable` содержит поле `is_manual: boolean`
- [ ] L2: Mock-данные содержат 2 ручных стола (`manual-001` «42», `manual-002` «Столик у входа»)
- [ ] L2: Ручной стол `manual-001` замаплен (SF234207G), `manual-002` — нет
- [ ] L3: Кнопка «+ Ручной стол» расположена между таблицей маппинга и sticky footer
- [ ] L3: Кнопка — ghost, sm, иконка `plus`, текст «Ручной стол»
- [ ] L3: Клик по кнопке → раскрывается inline-форма (input `w-48` + «Добавить» + «Отмена»)
- [ ] L3: Input с placeholder «Номер / название стола», maxLength=50, autoFocus
- [ ] L3: Подсказка под input: «Максимум 50 символов. Для фудкортов без столов в iiko»
- [ ] L3: Валидация: не пустое, max 50 символов, уникальность (case-insensitive)
- [ ] L3: При ошибке валидации — текст `text-red-500 text-xs` под полем, рамка `border-red-500`
- [ ] L3: Enter → добавить, Escape → отмена
- [ ] L3: После добавления стол появляется в таблице маппинга с бейджем `(ручной)`
- [ ] L4: Бейдж `(ручной)` — `text-xs text-gray-400 italic`, после названия стола
- [ ] L4: Бейдж отображается только для столов с `is_manual === true`
- [ ] L5: Иконка `trash-2` в строке ручного стола → UiConfirmDialog
- [ ] L5: UiConfirmDialog: «Удалить ручной стол «{name}»? Привязанные точки будут освобождены.»
- [ ] L5: При удалении привязанные точки возвращаются в пул свободных
- [ ] L5: Удаление локальное до «Сохранить» — «Сбросить» отменяет удаление
- [ ] L5: У столов из iiko иконка `trash-2` **отсутствует**
- [ ] L6: Toast #17 «Ручной стол «{name}» добавлен» при добавлении
- [ ] L7: Toast #18 «Ручной стол «{name}» удалён» при удалении
- [ ] L8: Фильтр по залу: ручные столы видны **при любом** выборе (включая конкретные залы)
- [ ] L8: Ручные столы отображаются **в конце таблицы** (после столов iiko)
- [ ] L8: Warning-блок учитывает незамапленные ручные столы в подсчёте
- [ ] Кнопка «Сохранить» активируется при любых изменениях (добавление / удаление ручных столов)
- [ ] Кнопка «Сбросить» отменяет все несохранённые изменения (включая ручные столы)

---

## История изменений

| Версия | Дата       | Автор        | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ------ | ---------- | ------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1.9    | 2026-02-18 | Кирилл Тюрин | L1–L8: Ручной ввод номера стола для фудкортов [Р2] на экране маппинга (Э3 / Б2). Кнопка «+ Ручной стол», inline-форма ввода (input + валидация: непустое, max 50, уникальность), бейдж `(ручной)`, удаление через `trash-2` + UiConfirmDialog. Ручные столы всегда видны при фильтрации по залу (в конце таблицы). Mock-данные: 2 ручных стола (1 замаплен, 1 нет). Toast #17–18. Источник: SPEC-002 v1.15 [Р2], встреча 06.02 (Руслан). |
