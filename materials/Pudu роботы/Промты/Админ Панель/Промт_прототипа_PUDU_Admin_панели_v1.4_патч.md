# Промт-патч v1.4: Панель администрирования роботов PUDU в iikoWeb

---
**Версия**: 1.4
**Дата**: 2026-02-16
**Автор**: Кирилл Тюрин (системный аналитик)
**Статус**: [PENDING]
**Артефакт**: Д3-патч (Промт-патч для обновления прототипа iikoWeb)
**Базовый документ**: Промт_прототипа_PUDU_Admin_панели_v1.3_патч.md (v1.3, 2026-02-13)
**Источники**: SPEC-002 v1.11.1 (разделы 3, 3а, 6, 7); STYLE_GUIDE.md (iikoWeb); КОПИЯ Спецификация iikoArrivals.md (паттерн двухуровневой навигации); План дополнения спецификаций v3.1 (этапы Э0, Э6, Э9.1)
**Scope**: Э8.1 — экран Б0, двухуровневая навигация, breadcrumb, tooltips, фильтр зала
---

## Назначение

Этот документ — **дельта-патч** к промту v1.3. Он описывает **только изменения**, которые необходимо внести в прототип Admin Panel по результатам дополнения SPEC-002 (этапы Э0, Э6, Э9.1 плана).

**Инструкция по применению**: сначала примени базовый промт `Промт_прототипа_PUDU_Admin_панели.md` (v1.1), затем патч v1.2, затем патч v1.3, и затем этот патч v1.4 — последовательно. Каждый раздел указывает, что **удалить**, что **добавить** и что **изменить**.

**Ключевые изменения v1.4:**
- Добавлен новый экран **Э0 «Список ресторанов» (Б0)** — корневой входной экран раздела PUDU
- Навигация изменена с **плоской** (3 пункта sidebar) на **двухуровневую** (корневой экран + контекст ресторана)
- Добавлен **breadcrumb** в subheader на всех экранах Б1–Б5
- Добавлены **tooltips** (`title` / `aria-label`) на все интерактивные элементы и значения
- Добавлен **фильтр по залу** (UiSelect) на экране Э3 «Маппинг столов»
- Обновлены **mock-данные**: рестораны, столы с залами, состояния настройки
- Обновлена **файловая структура** проекта

---

## Совместимость с предыдущими патчами

| Патч | Совместимость | Примечания                                                                                                                                                                                                                                                                                                                                                                                                       |
| ---- | ------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| v1.2 | **Совместим** | Все изменения v1.2 (C1–C10) сохраняют силу. Sidebar из v1.2 заменяется новой структурой (F2). Экраны Э1–Э4 работают без изменений в контексте ресторана. Вкладка «Общие» (C8, убрана в v1.2) остаётся убранной. Переключатель вариантов маппинга (C3 SegmentedControl) — в SPEC-002 направление маппинга остаётся открытым вопросом (#14), поэтому SegmentedControl сохраняется без изменений в toolbar-зоне Э3. |
| v1.3 | **Совместим** | Все изменения v1.3 (Е1–Е5) сохраняют силу. Технические идентификаторы точек, эксклюзивное назначение и удаление столбца «Действия» — без изменений. Mock-данные точек из v1.3 расширяются mock-данными ресторанов (F7).                                                                                                                                                                                          |

---

## Перечень изменений v1.4

| #   | Изменение                                                | Область     | Причина                                                                         |
| --- | -------------------------------------------------------- | ----------- | ------------------------------------------------------------------------------- |
| F1  | Новый экран Э0 «Список ресторанов» (Б0)                  | Новый экран | Организация может управлять несколькими ресторанами. Нужен входной экран выбора |
| F2  | Sidebar: 1 пункт «Настройки PUDU» вместо 3               | Sidebar     | Двухуровневая навигация: корневой экран → контекст ресторана                    |
| F3  | Breadcrumb в subheader + кнопка «Назад»                  | Subheader   | Навигация «Настройки PUDU > {Ресторан} > {Экран}» и возврат на Э0               |
| F4  | Tooltips на все интерактивные элементы                   | Все экраны  | Accessibility и понятность UI                                                   |
| F5  | Confirm-диалог при смене фразы (24ч)                     | Э4          | Расширение скопа v1.2 C4 на все вкладки с фразами                               |
| F6  | Фильтр по залу в Э3 (Маппинг) + перенос «Обновить точки» | Э3          | SPEC-002 раздел 6 — фильтрация столов по `section_name`                         |
| F7  | Обновление mock-данных: рестораны                        | Mock        | Демонстрация мультитенантности                                                  |
| F8  | Обновление mock-данных: столы с залами                   | Mock        | Демонстрация фильтра по залу                                                    |
| F9  | Обновление файловой структуры                            | Структура   | Новые файлы для Э0, breadcrumb, фильтра                                         |
| F10 | Обновление Toast-уведомлений                             | Toast       | Новый toast #10 (24ч блокировка фразы)                                          |
| F11 | Обновление чеклиста прототипа                            | Чеклист     | Новые проверки для Э0, breadcrumb, tooltips                                     |
| F12 | Warning-блок «одна поездка = один стол» (send_dish)      | Э4          | Бизнес-правило из SPEC-002 раздел 7.3 [Р3, Э9.1c]                               |
| F13 | Info-блок «мультивыбор столов» (cleanup)                 | Э4          | Бизнес-правило из SPEC-002 раздел 7.4 [Р4, Э9.1d]                               |

---

## F1. Новый экран Э0 — Список ресторанов (app/page.tsx)

> **Источник**: SPEC-002 v1.11.1, раздел 3а «Настройки PUDU — Выбор ресторана (Б0)»
> **Паттерн**: КОПИЯ Спецификация iikoArrivals.md — двухуровневая навигация «список ресторанов → контекст ресторана»

**Приоритет**: **Must**

### Subheader

| Элемент       | Значение                              |
| ------------- | ------------------------------------- |
| H1 заголовок  | «Настройки PUDU»                      |
| Кнопка справа | Нет (на корневом экране нет действий) |

### Строка поиска

Размещается под subheader, в content area, `mb-4`:

| Элемент      | Описание                                                                                                                           |
| ------------ | ---------------------------------------------------------------------------------------------------------------------------------- |
| Ширина       | `w-80` (320px)                                                                                                                     |
| Высота       | `h-9` (36px)                                                                                                                       |
| CSS-классы   | `rounded-md border border-gray-300 bg-white pl-9 pr-3 text-sm outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500` |
| Иконка       | Lucide `search`, size 16, `absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 z-10`                                            |
| Placeholder  | «Поиск по названию ресторана...» (`text-gray-400`)                                                                                 |
| Поведение    | Фильтрация в реальном времени по подстроке, debounce **300 мс**                                                                    |
| `aria-label` | «Поиск ресторана»                                                                                                                  |

### Таблица ресторанов

Таблица (список) ресторанов со следующими столбцами:

| #   | Столбец            | Тип данных | Стилизация                              | Tooltip (`title`)                                                                                  |
| --- | ------------------ | ---------- | --------------------------------------- | -------------------------------------------------------------------------------------------------- |
| 1   | Название ресторана | string     | `text-sm text-gray-900`                 | «Название ресторана (торгового предприятия) из платформы iiko»                                     |
| 2   | Всего роботов      | number     | `text-sm text-gray-700 text-center`     | «Общее количество зарегистрированных роботов PUDU в этом ресторане (не считая удалённых)»          |
| 3   | Активных роботов   | number     | `text-sm text-gray-700 text-center`     | «Количество роботов, которые сейчас подключены к облаку PUDU и доступны для выполнения задач»      |
| 4   | Статус настройки   | UiBadge    | См. ниже                                | «Агрегированный статус готовности интеграции PUDU: настроены ли роботы, маппинг столов и сценарии» |
| 5   | —                  | Иконка     | `chevron-right` (16px, `text-gray-400`) | —                                                                                                  |

**Стилизация таблицы**: аналогична Э1 — `bg-white`, `border border-gray-200`, `rounded-lg`, header `bg-gray-50 text-xs font-medium text-gray-500 uppercase`.

**Строка таблицы**: вся строка кликабельна (`cursor-pointer`), `hover:bg-gray-100 transition-colors`.

**Бейджи статуса настройки:**

| Статус           | Условие                                                             | Иконка Lucide    | Цвет              | Текст бейджа   |
| ---------------- | ------------------------------------------------------------------- | ---------------- | ----------------- | -------------- |
| **Настроено**    | Есть роботы AND маппинг заполнен AND хотя бы 1 сценарий включён     | `check-circle-2` | `text-green-600`  | «Настроено»    |
| **Частично**     | Есть роботы, но маппинг не завершён ИЛИ ни один сценарий не включён | `alert-circle`   | `text-orange-500` | «Частично»     |
| **Не настроено** | Нет зарегистрированных роботов                                      | `circle`         | `text-gray-300`   | «Не настроено» |

`aria-label` на бейдже: «Статус настройки: {статус}».

### Клик по строке ресторана

1. Сохранить `account_id` в контекст (React state / URL param)
2. Раскрыть подпункты sidebar (Роботы PUDU, Маппинг столов, Настройки роботов)
3. Навигация на экран **Э1** (Список роботов) для выбранного ресторана
4. В subheader — breadcrumb с названием ресторана

`aria-label` на строке: «Перейти к настройкам {Название ресторана}», `role="link"`.

### Состояния экрана Э0

| Состояние        | Условие                    | UI                                                                                                                          |
| ---------------- | -------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| **Загрузка**     | Запрос данных              | Спиннер `loader-2` по центру (`animate-spin text-gray-400`, size 32)                                                        |
| **С данными**    | Есть хотя бы 1 ресторан    | Таблица с `animate-fade-in`                                                                                                 |
| **Пустое**       | 0 ресторанов               | Серый текст по центру (`text-gray-400 text-sm`): «Нет ресторанов, доступных для настройки PUDU» с `role="status"`           |
| **Пустой поиск** | Фильтр не нашёл совпадений | Серый текст по центру (`text-gray-400 text-sm`): «Ничего не найдено»                                                        |
| **Ошибка**       | Ошибка загрузки            | UiAlert (красный): «Не удалось загрузить список ресторанов. Попробуйте обновить страницу», кнопка «Обновить» (`refresh-cw`) |

### Интерактивность прототипа

- При запуске: показать «Загрузка» (1 сек), затем таблица с `animate-fade-in`
- Ввод в поиск → фильтрация по подстроке `restaurant_name` (case-insensitive, debounce 300 мс)
- Клик по строке → сохранить контекст ресторана → раскрыть sidebar → перейти на Э1
- При 0 результатов фильтрации — показать «Ничего не найдено»

---

## F2. Sidebar: двухуровневая навигация

> **Источник**: SPEC-002 v1.11.1, раздел 3.1 «Структура sidebar (двухуровневая навигация)»

### УДАЛИТЬ из Sidebar (раздел 3.2 базового промта)

Удалить текущую таблицу 3 пунктов sidebar:

```
| # | Иконка | Текст             | Route       |
| 1 | bot    | Роботы PUDU       | /robots     |
| 2 | map-pin| Маппинг столов    | /mapping    |
| 3 | settings| Настройки роботов| /settings   |
```

### ДОБАВИТЬ: двухуровневая навигация

**Уровень 1 (всегда видим):**

| #   | Иконка Lucide | Текст          | Route | Описание                  |
| --- | ------------- | -------------- | ----- | ------------------------- |
| 1   | `bot`         | Настройки PUDU | `/`   | Корневой пункт → экран Э0 |

**Уровень 2 (видим только после выбора ресторана на Э0):**

Подпункты появляются с `animate-fade-in` при выборе ресторана. Визуально — вложенные элементы с отступом слева `pl-6`:

| #   | Иконка Lucide | Текст             | Route       | Описание                            |
| --- | ------------- | ----------------- | ----------- | ----------------------------------- |
| 2a  | `bot`         | Роботы PUDU       | `/robots`   | Список роботов выбранного ресторана |
| 2b  | `map-pin`     | Маппинг столов    | `/mapping`  | Маппинг столов к точкам             |
| 2c  | `settings`    | Настройки роботов | `/settings` | Настройки сценариев                 |

**Стилизация:**
- Корневой пункт (уровень 1): стандартная стилизация — `px-3 py-2 rounded`
  - Активный (на экране Э0): `bg-blue-50 text-blue-700 font-medium`
  - Неактивный (на экранах Э1–Э4): `text-gray-600 hover:bg-gray-100`
- Подпункты (уровень 2): `pl-6 px-3 py-1.5 text-sm rounded`
  - Активный: `bg-blue-50 text-blue-700 font-medium`
  - Неактивный: `text-gray-600 hover:bg-gray-100`

**Поведение:**
1. При первом входе → видим **только** корневой пункт «Настройки PUDU»
2. Клик на корневой → экран Э0 (список ресторанов)
3. Выбор ресторана → подпункты появляются (`animate-fade-in`), «Роботы PUDU» активный
4. Клик «← Назад к списку ресторанов» → подпункты **скрываются**, контекст ресторана очищен, экран Э0
5. Клик на корневой пункт (при раскрытых подпунктах) → аналогично «Назад» — возврат на Э0

`aria-label` на подпунктах: «{Текст} для {Название ресторана}».

**Обновить layout-диаграмму** (раздел 2.1 базового промта):

```
┌─────────────────────────────────────────────────────────┐
│  HEADER  (h-14, border-b, bg-white)                     │
│  [Логотип iiko]                    [Поиск] [Профиль ▼]  │
├──────────┬──────────────────────────────────────────────┤
│ SIDEBAR  │  SUBHEADER (border-b, bg-white, px-6 py-4)  │
│ (w-52)   │  [← Назад] [Breadcrumb / H1]  [Действия]   │
│          │  ────────────────────────────────────────────  │
│ Настрой- │  CONTENT AREA (bg-gray-50, p-6)             │
│ ки PUDU  │                                              │
│          │  Контент экрана                              │
│  ├Роботы │  (таблица / форма / вкладки)                │
│  │ PUDU  │                                              │
│  ├Маппинг│                                              │
│  │столов │                                              │
│  └Настр. │                                              │
│   роботов│                                              │
│          │                                              │
│ ──────── │                                              │
│ © 2026   │                                              │
└──────────┴──────────────────────────────────────────────┘
```

> **Примечание**: подпункты `├Роботы PUDU`, `├Маппинг столов`, `└Настр. роботов` видимы только после выбора ресторана на экране Э0.

---

## F3. Breadcrumb в subheader

> **Источник**: SPEC-002 v1.11.1, раздел 3.3 «Контекст ресторана и breadcrumbs»

### ИЗМЕНИТЬ subheader (раздел 3.3 базового промта)

**Было** (v1.1–v1.3): Subheader содержит только H1 заголовок:
```html
<div class="flex items-center justify-between gap-4">
  <h1 class="text-2xl font-semibold text-gray-900">{Заголовок}</h1>
  <!-- Кнопки действий -->
</div>
```

**Стало** (v1.4): Subheader содержит кнопку «Назад» + breadcrumb + H1 + кнопки:

```html
<div class="border-b border-gray-200 bg-white px-6 py-4 shrink-0">
  <div class="flex items-center justify-between gap-4">
    <div class="flex items-center gap-3">
      <!-- Кнопка «Назад» (видна только на экранах Э1–Э4, НЕ на Э0) -->
      <button class="inline-flex items-center gap-1.5 text-sm text-gray-500 hover:text-gray-700 transition-colors"
              aria-label="Назад к списку ресторанов">
        <ArrowLeft size={16} />
        <span>Назад к списку ресторанов</span>
      </button>
      <!-- Breadcrumb -->
      <nav class="flex items-center gap-1.5 text-sm" aria-label="Breadcrumb">
        <span class="text-gray-400">Настройки PUDU</span>
        <ChevronRight size={14} class="text-gray-300" />
        <span class="text-gray-400">{Название ресторана}</span>
        <ChevronRight size={14} class="text-gray-300" />
        <span class="text-gray-900 font-medium">{Текущий экран}</span>
      </nav>
    </div>
    <!-- Кнопки действий справа -->
  </div>
</div>
```

**Примеры breadcrumb по экранам:**

| Экран  | Кнопка «Назад» | Breadcrumb                                                          | H1 (в breadcrumb) |
| ------ | -------------- | ------------------------------------------------------------------- | ----------------- |
| **Э0** | Нет            | Нет (H1: «Настройки PUDU» как единственный элемент)                 | «Настройки PUDU»  |
| **Э1** | Да             | Настройки PUDU > Ресторан «Белуга» Тверская > **Роботы PUDU**       | Роботы PUDU       |
| **Э2** | — (модалка)    | —                                                                   | —                 |
| **Э3** | Да             | Настройки PUDU > Ресторан «Белуга» Тверская > **Маппинг столов**    | Маппинг столов    |
| **Э4** | Да             | Настройки PUDU > Ресторан «Белуга» Тверская > **Настройки роботов** | Настройки роботов |

**Поведение кнопки «Назад»:**
1. Клик → очистить контекст ресторана
2. Свернуть подпункты sidebar
3. Навигация на экран Э0
4. Подпункты sidebar скрываются

> **ВАЖНО**: На экране Э0 subheader содержит **только** H1 «Настройки PUDU» (без breadcrumb и без кнопки «Назад»).

---

## F4. Tooltips на все интерактивные элементы

> **Источник**: SPEC-002 v1.11.1 — столбцы «Tooltip» и «Источник данных» в таблицах полей всех экранов; План этап Э6

### ДОБАВИТЬ: системные правила tooltips

Добавить в раздел **10. Accessibility** базового промта следующие правила:

**Правила применения tooltips (`title` / `aria-label`):**

1. **Все кнопки** — обязательный `aria-label` с описанием действия
2. **Все иконки-индикаторы** (статусы, бейджи) — `title` с текстовой расшифровкой
3. **Все столбцы таблиц** — `title` на заголовке столбца с пояснением содержимого
4. **Все поля формы** — подсказка `text-xs text-gray-400` под полем (уже реализовано) + `aria-describedby` к подсказке
5. **Disabled-элементы** — `title` с причиной недоступности

### ДОБАВИТЬ: tooltips для экрана Э0

| Элемент                      | Атрибут       | Значение                                                                                           |
| ---------------------------- | ------------- | -------------------------------------------------------------------------------------------------- |
| Строка поиска                | `aria-label`  | «Поиск ресторана»                                                                                  |
| Заголовок «Всего роботов»    | `title`       | «Общее количество зарегистрированных роботов PUDU в этом ресторане (не считая удалённых)»          |
| Заголовок «Активных роботов» | `title`       | «Количество роботов, которые сейчас подключены к облаку PUDU и доступны для выполнения задач»      |
| Заголовок «Статус настройки» | `title`       | «Агрегированный статус готовности интеграции PUDU: настроены ли роботы, маппинг столов и сценарии» |
| Бейдж «Настроено»            | `aria-label`  | «Статус настройки: Настроено»                                                                      |
| Бейдж «Частично»             | `aria-label`  | «Статус настройки: Частично»                                                                       |
| Бейдж «Не настроено»         | `aria-label`  | «Статус настройки: Не настроено»                                                                   |
| Строка таблицы               | `aria-label`  | «Перейти к настройкам {Название ресторана}»                                                        |
| Иконка `chevron-right`       | `aria-hidden` | `true` (декоративная)                                                                              |

### ДОБАВИТЬ: tooltips для экрана Э1 (Список роботов)

| Элемент                           | Атрибут      | Значение                                                                                                                   |
| --------------------------------- | ------------ | -------------------------------------------------------------------------------------------------------------------------- |
| Кнопка «Добавить робота»          | `aria-label` | «Добавить нового робота»                                                                                                   |
| Кнопка «Удалить»                  | `aria-label` | «Удалить робота {name}»                                                                                                    |
| Бейдж «В сети»                    | `title`      | «Робот подключён к облаку PUDU и доступен для задач»                                                                       |
| Бейдж «Не в сети»                 | `title`      | «Робот не подключён к облаку PUDU»                                                                                         |
| Бейдж «Ошибка»                    | `title`      | «Ошибка подключения к облаку PUDU»                                                                                         |
| Заголовок «Имя робота»            | `title`      | «Отображаемое имя робота. Заполняется автоматически при регистрации из NE, можно отредактировать»                          |
| Заголовок «ID робота»             | `title`      | «Серийный номер робота в системе PUDU. Неизменяемый, задаётся при регистрации»                                             |
| Заголовок «Статус»                | `title`      | «Текущий статус подключения робота к облаку PUDU. online — робот доступен, offline — нет связи, ошибка — сбой подключения» |
| Заголовок «Активная карта»        | `title`      | «Название активной карты зала робота в системе PUDU. Настраивается инженером NE при установке»                             |
| Заголовок «Действие после задачи» | `title`      | «Поведение робота после завершения задачи: ожидает новую задачу или переходит в маркетинговый круиз»                       |
| Select «after_action»             | `aria-label` | «Действие после задачи для робота {name}»                                                                                  |
| Кнопка «Назад» (subheader)        | `aria-label` | «Назад к списку ресторанов»                                                                                                |

### ДОБАВИТЬ: tooltips для экрана Э2 (Регистрация робота)

| Элемент                   | Атрибут            | Значение                                             |
| ------------------------- | ------------------ | ---------------------------------------------------- |
| Кнопка «Зарегистрировать» | `aria-label`       | «Зарегистрировать робота»                            |
| Кнопка «Отмена»           | `aria-label`       | «Отменить регистрацию»                               |
| Поле «ID робота»          | `aria-describedby` | ID подсказки «Серийный номер робота из системы PUDU» |
| Поле «Имя робота»         | `aria-describedby` | ID подсказки «Имя робота для идентификации...»       |

### ДОБАВИТЬ: tooltips для экрана Э3 (Маппинг столов)

| Элемент                           | Атрибут      | Значение                                                                                                 |
| --------------------------------- | ------------ | -------------------------------------------------------------------------------------------------------- |
| Кнопка «Обновить точки»           | `aria-label` | «Обновить список точек с карты робота»                                                                   |
| Кнопка «Сохранить» (footer)       | `aria-label` | «Сохранить маппинг столов к точкам»                                                                      |
| Кнопка «Сбросить» (footer)        | `aria-label` | «Отменить несохранённые изменения маппинга»                                                              |
| Кнопка «+ Точку»                  | `aria-label` | «Добавить привязку точки к столу {table_name}»                                                           |
| Кнопка удаления точки (`x`)       | `aria-label` | «Удалить привязку точки {point_name} от стола {table_name}»                                              |
| Select точки                      | `aria-label` | «Выбор точки робота для стола {table_name}»                                                              |
| Заголовок «Стол iiko»             | `title`      | «Название стола из конфигурации залов iiko. Для ручных столов — введённый пользователем номер»           |
| Заголовок «Привязанные точки»     | `title`      | «Точки на карте робота, привязанные к этому столу. Один стол может иметь несколько точек подъезда (1:N)» |
| Заголовок «Статус»                | `title`      | «Индикатор наличия привязки точек к столу. Зелёный — стол замаплен, серый — нет привязки»                |
| Иконка статуса (замаплен)         | `title`      | «Стол привязан к точке робота»                                                                           |
| Иконка статуса (не замаплен)      | `title`      | «Стол не привязан к точке — робот не сможет доставить заказ»                                             |
| Warning-блок «столы без привязки» | `role`       | `alert`                                                                                                  |
| Select «Зал» (фильтр)             | `aria-label` | «Фильтр столов по залу ресторана»                                                                        |

### ДОБАВИТЬ: tooltips для экрана Э4 (Настройки сценариев)

| Элемент                                       | Атрибут      | Значение                                                                          |
| --------------------------------------------- | ------------ | --------------------------------------------------------------------------------- |
| Кнопка «Сохранить» (footer)                   | `aria-label` | «Сохранить настройки сценариев»                                                   |
| Кнопка «Сбросить» (footer)                    | `aria-label` | «Отменить несохранённые изменения настроек»                                       |
| Вкладка «Доставка меню»                       | `title`      | «Настройки сценария доставки меню к столу гостя»                                  |
| Вкладка «Доставка блюд»                       | `title`      | «Настройки сценария доставки блюд из кухни к столу»                               |
| Вкладка «Уборка посуды»                       | `title`      | «Настройки сценария уборки грязной посуды со стола»                               |
| Вкладка «Оплата по QR»                        | `title`      | «Настройки сценария доставки QR-кода для оплаты»                                  |
| Вкладка «Маркетинг»                           | `title`      | «Настройки маркетингового круиза робота по залу»                                  |
| Radio «Ручной» (cleanup)                      | `title`      | «Уборка запускается вручную из iikoFront»                                         |
| Radio «Авто» (cleanup)                        | `title`      | «Уборка запускается автоматически по таймеру или закрытию чека»                   |
| Radio «Смешанный» (cleanup)                   | `title`      | «Ручной запуск всегда доступен + автоматические триггеры работают параллельно»    |
| Checkbox «Автозапуск при простое» (marketing) | `title`      | «Автоматически запускать маркетинг, когда у выбранного робота нет активных задач» |
| Checkbox «Запуск по таймеру» (marketing)      | `title`      | «Запускать маркетинговый круиз в заданном временном диапазоне»                    |
| Warning-блок PuduLink                         | `role`       | `alert`                                                                           |
| Info-блок (авто наследует из ручного)         | `role`       | `status`                                                                          |

---

## F5. Confirm-диалог при смене фразы (лимит 24ч)

> **Источник**: SPEC-002 v1.11.1, раздел 7 — ограничение 24ч на изменение фразы

### ИЗМЕНИТЬ confirm-диалог #3 в реестре Confirm-диалогов (раздел 8 базового промта)

> **Примечание**: Confirm-диалог #3 впервые добавлен в v1.2 C4 **только для вкладки send_menu**. Данный патч **расширяет** его скоп на **все вкладки** с полями фраз (send_menu, send_dish, cleanup, qr_payment) и обновляет текст.

| #   | Экран                      | Триггер                      | Заголовок         | Текст                                             | Кнопки                                              |
| --- | -------------------------- | ---------------------------- | ----------------- | ------------------------------------------------- | --------------------------------------------------- |
| 3   | Э4 (все вкладки с фразами) | Изменение любой фразы робота | «Изменение фразы» | «Изменить фразу можно раз в 24 часа. Продолжить?» | **«Продолжить»** (primary) / **«Отмена»** (outline) |

> **Для прототипа**: при изменении любой фразы и нажатии «Сохранить» — показать этот Confirm-диалог. После нажатия «Продолжить» — поле фразы становится `disabled` на 5 секунд (имитация 24ч блокировки), под полем появляется подсказка `text-xs text-gray-400 italic`: «Следующее изменение доступно через 23 ч 59 мин». Toast #10 **заменяет** generic toast «Изменения сохранены» из v1.2 C4 для данного сценария.

---

## F6. Фильтр по залу в Э3 (Маппинг столов)

> **Источник**: SPEC-002 v1.11.1, раздел 6 «Б2 Маппинг столов» — подраздел «Фильтр по залу» [Р1, Э9.1a]

### ДОБАВИТЬ в Э3 (раздел 6.3 базового промта)

### ИЗМЕНИТЬ Subheader Э3

**Убрать** кнопку «Обновить точки» из subheader экрана Э3. Кнопка переносится в **toolbar-строку** ниже (рядом с фильтром по залу).

**Было** (v1.1–v1.3): Subheader содержит H1 + кнопку «Обновить точки» справа.
**Стало** (v1.4): Subheader содержит только breadcrumb (F3) + H1. Кнопка «Обновить точки» — в toolbar-строке рядом с фильтром.

> **Примечание**: Кнопка «Обновить точки» в SPEC-002 описана в subheader, но для улучшения UX перенесена в toolbar-строку — логически группирует управление данными таблицы (фильтр + обновление) в одну линию.

### ДОБАВИТЬ toolbar-строку с фильтром по залу в Э3

Над таблицей маппинга (между subheader и таблицей) добавить **toolbar-строку** с UiSelect «Зал» и кнопкой «Обновить точки»:

| Элемент            | Описание                                                                                                            |
| ------------------ | ------------------------------------------------------------------------------------------------------------------- |
| Расположение       | В **toolbar-строке** под subheader, перед таблицей маппинга. Выравнивание: `flex items-center justify-between mb-4` |
| Контрол            | UiSelect (`w-64`)                                                                                                   |
| Label              | «Зал» (`text-sm font-medium text-gray-700`, перед select, `mr-2`)                                                   |
| Дефолтное значение | «Все залы»                                                                                                          |
| Опции              | «Все залы» (дефолт) + уникальные значения `section_name` из mock-столов                                             |
| `aria-label`       | «Фильтр столов по залу ресторана»                                                                                   |

**Поведение:**
1. При выборе зала — таблица показывает **только столы с выбранным `section_name`**
2. Точки NE (правая колонка) — **без фильтрации** (видны все привязанные точки для отфильтрованных столов)
3. При выборе «Все залы» — показать все столы
4. Маппинг (привязки) сохраняется **независимо** от фильтра — фильтр влияет только на видимость строк
5. **Ручные столы** (без привязки к залу iiko) отображаются **при любом** выборе фильтра, включая конкретные залы
6. При отсутствии `section_name` в данных (все столы без зала) — **select скрыт** (не отображается)

**Макет расположения** (под subheader):

```
┌──────────────────────────────────────────────────────────────┐
│  [Зал: ▼ Все залы]                        [↻ Обновить точки] │
├──────────────────────────────────────────────────────────────┤
│  ⚠ Warning: 3 столов не имеют привязки...                    │
├──────────────────────────────────────────────────────────────┤
│  ТАБЛИЦА МАППИНГА                                            │
│  ...                                                         │
└──────────────────────────────────────────────────────────────┘
```

---

## F7. Обновление mock-данных: рестораны

> **Контекст**: Для демонстрации экрана Э0 нужны данные нескольких ресторанов.

### ДОБАВИТЬ в mock-данные (раздел 5 базового промта)

Новый раздел **5.0. Рестораны** (перед разделом 5.1):

```typescript
// Список ресторанов организации
interface Restaurant {
  account_id: string;
  restaurant_name: string;
  robots_total: number;
  robots_online: number;
  mapping_completed: boolean;
  scenarios_enabled: number;
  setup_status: "configured" | "partial" | "not_configured";
}

const mockRestaurants: Restaurant[] = [
  {
    account_id: "550e8400-e29b-41d4-a716-446655440000",
    restaurant_name: "Ресторан «Белуга» Тверская",
    robots_total: 3,
    robots_online: 2,
    mapping_completed: true,
    scenarios_enabled: 2,
    setup_status: "configured"
  },
  {
    account_id: "550e8400-e29b-41d4-a716-446655440001",
    restaurant_name: "Кафе «Причал» Арбат",
    robots_total: 1,
    robots_online: 0,
    mapping_completed: false,
    scenarios_enabled: 0,
    setup_status: "partial"
  },
  {
    account_id: "550e8400-e29b-41d4-a716-446655440002",
    restaurant_name: "Бар «Маяк» Патрики",
    robots_total: 0,
    robots_online: 0,
    mapping_completed: false,
    scenarios_enabled: 0,
    setup_status: "not_configured"
  }
];
```

> **Примечание**: При клике на ресторан `550e8400-...440000` загружаются существующие mock-данные (роботы, точки, столы, настройки из разделов 5.1–5.5 базового промта). Остальные рестораны — заглушки с пустыми данными (0 роботов или минимальный набор). Названия и `account_id` соответствуют JSON-примеру API из SPEC-002 раздел 3а.3.

---

## F8. Обновление mock-данных: столы с залами

> **Контекст**: Для демонстрации фильтра по залу нужны столы из разных залов.

### ИЗМЕНИТЬ mock-данные столов (раздел 5.3 базового промта)

**Было (v1.1):**
```typescript
const mockTables: IikoTable[] = [
  { table_id: "tbl-001", table_name: "Стол №1", section_name: "Зал 1 этаж" },
  { table_id: "tbl-002", table_name: "Стол №2", section_name: "Зал 1 этаж" },
  // ... все столы с section_name: "Зал 1 этаж"
];
```

**Стало (v1.4):**
```typescript
const mockTables: IikoTable[] = [
  // Зал 1 этаж (5 столов)
  { table_id: "tbl-001", table_name: "Стол №1", section_name: "Зал 1 этаж" },
  { table_id: "tbl-002", table_name: "Стол №2", section_name: "Зал 1 этаж" },
  { table_id: "tbl-003", table_name: "Стол №3 (VIP)", section_name: "Зал 1 этаж" },
  { table_id: "tbl-004", table_name: "Стол №4 (бар)", section_name: "Зал 1 этаж" },
  { table_id: "tbl-005", table_name: "Стол №5", section_name: "Зал 1 этаж" },
  // Терраса (2 стола)
  { table_id: "tbl-006", table_name: "Стол №6", section_name: "Терраса" },
  { table_id: "tbl-007", table_name: "Стол №7", section_name: "Терраса" },
  // VIP-зал (1 стол)
  { table_id: "tbl-008", table_name: "Стол №8 (VIP)", section_name: "VIP-зал" }
];
```

**Результат**: фильтр по залу покажет опции:
- «Все залы» (дефолт) — 8 столов
- «Зал 1 этаж» — 5 столов
- «Терраса» — 2 стола
- «VIP-зал» — 1 стол

### ИЗМЕНИТЬ mock-данные маппинга (раздел 5.4 базового промта)

Маппинг остаётся аналогичным, но обновить комментарии, чтобы отражать новые залы:

```typescript
const mockMapping: TableMapping[] = [
  { table_id: "tbl-001", points: [mockPoints[0]] },         // Зал 1 этаж, Стол №1 → SF234201A
  { table_id: "tbl-002", points: [mockPoints[1]] },         // Зал 1 этаж, Стол №2 → SF234202B
  { table_id: "tbl-003", points: [mockPoints[2], mockPoints[3]] }, // Зал 1 этаж, Стол №3 (VIP) → SF234203C + SF234204D (демо 1:N)
  { table_id: "tbl-004", points: [mockPoints[4]] },         // Зал 1 этаж, Стол №4 (бар) → SF234205E
  { table_id: "tbl-005", points: [] },                       // Зал 1 этаж, Стол №5 → НЕ ЗАМАПЛЕН
  { table_id: "tbl-006", points: [mockPoints[5]] },         // Терраса, Стол №6 → SF234206F
  { table_id: "tbl-007", points: [] },                       // Терраса, Стол №7 → НЕ ЗАМАПЛЕН
  { table_id: "tbl-008", points: [] }                        // VIP-зал, Стол №8 → НЕ ЗАМАПЛЕН
];
```

> **Примечание**: `mockPoints` использует точки из v1.3 (технические идентификаторы SF234201A и т.д.).

---

## F9. Обновление файловой структуры

### ИЗМЕНИТЬ файловую структуру (раздел 11 базового промта)

**Добавить / изменить:**

```
app/
├── layout.tsx           // Layout: header + sidebar + main area
├── page.tsx             // Э0: НОВЫЙ — Список ресторанов (вместо redirect)
├── globals.css
├── robots/
│   └── page.tsx         // Э1: Список роботов (в контексте ресторана)
├── mapping/
│   └── page.tsx         // Э3: Маппинг столов к точкам
└── settings/
    └── page.tsx         // Э4: Настройки сценариев

components/
├── layout/
│   ├── header.tsx
│   ├── sidebar.tsx       // ИЗМЕНЁН: двухуровневая навигация
│   ├── subheader.tsx     // ИЗМЕНЁН: breadcrumb + кнопка «Назад»
│   └── breadcrumb.tsx    // НОВЫЙ: компонент breadcrumb
├── restaurants/
│   ├── restaurant-table.tsx   // НОВЫЙ: таблица ресторанов (Э0)
│   ├── restaurant-search.tsx  // НОВЫЙ: строка поиска
│   └── setup-badge.tsx        // НОВЫЙ: бейдж статуса настройки
├── robots/
│   ├── robots-table.tsx
│   └── robot-register-modal.tsx
├── mapping/
│   ├── mapping-table.tsx
│   ├── point-select.tsx
│   └── hall-filter.tsx        // НОВЫЙ: фильтр по залу
├── settings/
│   ├── settings-tabs.tsx
│   ├── tab-send-menu.tsx
│   ├── tab-send-dish.tsx
│   ├── tab-cleanup.tsx
│   ├── tab-qr-payment.tsx
│   └── tab-marketing.tsx
├── shared/
│   ├── phrase-input.tsx
│   ├── phrase-list.tsx         // Из v1.2 (C5), без изменений
│   ├── url-input.tsx           // Из v1.2 (C10), без изменений
│   ├── confirm-dialog.tsx
│   └── status-badge.tsx
└── ui/                        // shadcn/ui (без изменений)

lib/
├── mock-data.ts               // ИЗМЕНЁН: добавлены рестораны, обновлены столы
├── types.ts                   // ИЗМЕНЁН: добавлен Restaurant interface
├── utils.ts
└── restaurant-context.ts      // НОВЫЙ: контекст выбранного ресторана (React Context)

hooks/
├── use-toast.ts
├── use-unsaved-changes.ts
└── use-restaurant.ts          // НОВЫЙ: хук для доступа к контексту ресторана
```

---

## F10. Обновление Toast-уведомлений

### ДОБАВИТЬ в реестр Toast (раздел 7 базового промта)

> **Примечание**: Toast #8 «Настройка робота обновлена» уже добавлен в v1.2 C2. Toast #9 «Точка перенесена» добавлен в v1.3 E4. Нумерация продолжается с **#10**.

| #   | Экран | Триггер                   | Текст Title                                          | Длительность |
| --- | ----- | ------------------------- | ---------------------------------------------------- | ------------ |
| 10  | Э4    | Фраза заблокирована (24ч) | «Фраза сохранена. Следующее изменение через 24 часа» | 4 сек        |

---

## F11. Обновление итогового чеклиста

### ДОБАВИТЬ в раздел 14 базового промта

**Экран Э0: Список ресторанов**
- [ ] Subheader: H1 «Настройки PUDU» без кнопок
- [ ] Строка поиска с иконкой `search`, debounce 300 мс
- [ ] Таблица: 4 столбца (Название, Всего роботов, Активных, Статус настройки)
- [ ] Бейджи статуса: Настроено (зелёный), Частично (оранжевый), Не настроено (серый)
- [ ] Вся строка кликабельна → переход в контекст ресторана
- [ ] 3 mock-ресторана в таблице (configured, partial, not_configured) — названия из SPEC-002
- [ ] Пустое / Загрузка / Ошибка / Пустой поиск состояния
- [ ] Иконка `chevron-right` в конце каждой строки

**Навигация и breadcrumb**
- [ ] Sidebar: 1 корневой пункт «Настройки PUDU»
- [ ] Sidebar: подпункты появляются при выборе ресторана (`animate-fade-in`)
- [ ] Sidebar: подпункты скрываются при клике «Назад» или на корневой пункт
- [ ] Breadcrumb: «Настройки PUDU > {Ресторан} > {Экран}» на всех Э1–Э4
- [ ] Breadcrumb: отсутствует на Э0
- [ ] Кнопка «← Назад к списку ресторанов» в subheader на Э1–Э4
- [ ] Контекст ресторана (`account_id`) передаётся на все экраны

**Tooltips и доступность**
- [ ] `aria-label` на всех кнопках (Добавить, Удалить, Сохранить, Сбросить, Обновить, Назад, + Точку, x)
- [ ] `title` на всех заголовках столбцов таблиц
- [ ] `title` на всех бейджах статусов
- [ ] `aria-label` на всех select-контролах (фильтр зала, after_action, выбор точки)
- [ ] `aria-describedby` на полях форм → связь с подсказкой
- [ ] `role="alert"` на warning-блоках
- [ ] `role="status"` на info-блоках и пустых состояниях
- [ ] `aria-label` на breadcrumb (`nav`)

**Фильтр по залу (Э3)**
- [ ] UiSelect «Зал» над таблицей маппинга (`w-64`)
- [ ] Опции: «Все залы» + уникальные section_name из столов
- [ ] Фильтрация только левого столбца (столы iiko)
- [ ] Ручные столы отображаются при любом фильтре
- [ ] При отсутствии section_name — select скрыт
- [ ] Mock-данные: 3 зала (Зал 1 этаж — 5 столов, Терраса — 2, VIP-зал — 1)

**Бизнес-блоки Э4 (send_dish / cleanup)**
- [ ] Warning-блок «одна поездка = один стол» на вкладке send_dish
- [ ] Info-блок «мультивыбор столов» на вкладке cleanup

**Confirm-диалог (24ч фраза)**
- [ ] Confirm при сохранении изменённой фразы
- [ ] Имитация блокировки (disabled 5 сек)
- [ ] Подсказка «Следующее изменение через...»

---

## F12. Warning-блок «одна поездка = один стол» (вкладка send_dish)

> **Источник**: SPEC-002 v1.11.1, раздел 7.3 «Настройки → send_dish» [Р3, Э9.1c]

### ДОБАВИТЬ в Э4 (вкладка «Доставка блюд»)

Над полями настроек вкладки send_dish добавить **Warning-блок** (`border-orange-200 bg-orange-50/50`):

| Элемент      | Значение                                                                                                                        |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| Иконка       | Lucide `alert-triangle` (16px, `text-orange-500`)                                                                               |
| Текст        | «Одна поездка робота обрабатывает блюда только для одного стола. Блюда для разных столов НЕ совмещаются в рамках одного рейса.» |
| CSS-классы   | `flex items-start gap-3 rounded-lg border border-orange-200 bg-orange-50/50 p-4 text-sm text-orange-800`                        |
| `role`       | `alert`                                                                                                                         |
| Расположение | Под названием вкладки, над первым полем настроек send_dish                                                                      |

---

## F13. Info-блок «мультивыбор столов для уборки» (вкладка cleanup)

> **Источник**: SPEC-002 v1.11.1, раздел 7.4 «Настройки → cleanup» [Р4, Э9.1d]

### ДОБАВИТЬ в Э4 (вкладка «Уборка посуды»)

В секции ручного/смешанного режима уборки добавить **Info-блок** (`border-blue-200 bg-blue-50/50`):

| Элемент      | Значение                                                                                                                                                |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Иконка       | Lucide `info` (16px, `text-blue-500`)                                                                                                                   |
| Текст        | «Плагин iikoFront поддерживает выбор нескольких столов для одной задачи уборки (мультивыбор). Робот объезжает столы последовательно. См. SPEC-003, В3.» |
| CSS-классы   | `flex items-start gap-3 rounded-lg border border-blue-200 bg-blue-50/50 p-4 text-sm text-blue-800`                                                      |
| `role`       | `status`                                                                                                                                                |
| Расположение | После radio-группы выбора режима (ручной / авто / смешанный)                                                                                            |

---

## История изменений

| Версия | Дата       | Автор        | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ------ | ---------- | ------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1.4    | 2026-02-16 | Кирилл Тюрин | Патч Э8.1: экран Б0 (список ресторанов), двухуровневая навигация sidebar, breadcrumb, tooltips на все элементы, фильтр по залу в маппинге, обновлённые mock-данные (рестораны, столы с залами), confirm-диалог 24ч фразы, warning/info бизнес-блоки. Верификация 16.02: исправлены тексты tooltips (соответствие SPEC-002), mock-данные ресторанов (названия из API-контракта), текст confirm-диалога, визуальный текст кнопки «Назад», поведение фильтра (ручные столы, скрытие) |
